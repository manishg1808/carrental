<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Images | Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        adminBg: '#F8FAF8',
                        adminWhite: '#FFFFFF',
                        adminGreen: '#000000',
                        adminGold: '#FFD700',
                        adminText: '#1F2937',
                        adminMuted: '#6B7280',
                        adminBorder: '#111111'
                    }
                }
            }
        };
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/admin/css/admin.css">
</head>
<body class="bg-adminBg text-adminText min-h-screen">
<header class="sticky top-0 z-30 border-b border-adminBorder bg-adminWhite/95 backdrop-blur">
    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-11 h-11 rounded-xl bg-adminGold text-white flex items-center justify-center shadow-md">
                <i class="fas fa-gauge-high"></i>
            </div>
            <div>
                <h1 class="text-xl font-extrabold">Admin Dashboard</h1>
                <p class="text-sm text-adminMuted">Images</p>
            </div>
        </div>
        <a href="/index.html" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-adminGreen text-white font-semibold hover:brightness-110 transition">
            <i class="fas fa-house"></i>
            Back To Site
        </a>
    </div>
</header>

<div id="sidebar-overlay" class="sidebar-overlay lg:hidden"></div>

<main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="lg:hidden mb-4">
        <button id="sidebar-toggle" type="button" class="sidebar-toggle-btn">
            <i class="fas fa-bars"></i>
            <span>Menu</span>
        </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <aside id="admin-sidebar" class="admin-sidebar lg:col-span-3 xl:col-span-2 panel p-4 h-max lg:sticky lg:top-24">
            <div class="lg:hidden flex items-center justify-between mb-4 pb-3 border-b border-adminBorder">
                <p class="text-sm font-extrabold text-adminMuted">Admin Menu</p>
                <button id="sidebar-close" type="button" class="w-9 h-9 rounded-full border border-adminBorder bg-white text-adminText">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="space-y-1"></nav>
        </aside>

        <section class="lg:col-span-9 xl:col-span-10 space-y-6">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <article class="panel p-4">
                    <p class="text-sm text-adminMuted">Total Images</p>
                    <p id="img-total" class="mt-2 text-3xl font-extrabold">0</p>
                </article>
                <article class="panel p-4">
                    <p class="text-sm text-adminMuted">Categories Used</p>
                    <p id="img-categories" class="mt-2 text-3xl font-extrabold text-adminGreen">0</p>
                </article>
                <article class="panel p-4">
                    <p class="text-sm text-adminMuted">Latest Upload</p>
                    <p id="img-latest" class="mt-2 text-sm font-extrabold">-</p>
                </article>
            </div>

            <div class="panel p-6">
                <h2 class="text-2xl font-extrabold">Upload Gallery Image</h2>
                <p class="text-sm text-adminMuted mt-1">Create images for gallery page, banners, and service highlights.</p>

                <form id="image-form" class="mt-4 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-3">
                    <input id="image-title" type="text" placeholder="Image title" required class="px-4 py-2.5 rounded-lg border border-adminBorder">
                    <select id="image-category" required class="px-4 py-2.5 rounded-lg border border-adminBorder">
                        <option value="" selected disabled>Select category</option>
                        <option value="Fleet">Fleet</option>
                        <option value="Service">Service</option>
                        <option value="Premium">Premium</option>
                        <option value="Event">Event</option>
                        <option value="Banner">Banner</option>
                    </select>
                    <input id="image-file" type="file" accept="image/*" required class="px-3 py-2.5 rounded-lg border border-adminBorder bg-white">
                    <button type="submit" class="px-5 py-2.5 rounded-lg bg-adminGreen text-white font-bold">
                        <i class="fas fa-upload mr-1"></i>Save Image
                    </button>
                </form>

                <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div class="rounded-lg border border-adminBorder p-3">
                        <p class="text-sm font-bold">Preview</p>
                        <img id="image-preview" src="/images/5.jpg" alt="Preview" class="mt-2 w-full h-40 object-cover rounded-lg border border-adminBorder">
                    </div>
                    <div class="rounded-lg border border-adminBorder p-3 flex items-center justify-center">
                        <p id="image-msg" class="text-sm font-bold text-adminMuted">All fields are required.</p>
                    </div>
                </div>
            </div>

            <div class="panel p-6">
                <h3 class="text-xl font-extrabold mb-4">Saved Images</h3>
                <div id="image-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
            </div>
        </section>
    </div>
</main>

<script src="/admin/js/admin-sidebar.js"></script>
<script>
    const IMAGE_STORAGE_KEY = 'adminGalleryImages';
    const imageForm = document.getElementById('image-form');
    const imageFileInput = document.getElementById('image-file');
    const imagePreview = document.getElementById('image-preview');
    const imageMsg = document.getElementById('image-msg');
    const imageGrid = document.getElementById('image-grid');
    let uploadedImageData = '';

    function escapeHtml(text) {
        return String(text || '')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
    }

    function formatDate(value) {
        const date = new Date(value || '');
        if (Number.isNaN(date.getTime())) return '-';
        return date.toLocaleDateString();
    }

    function loadImages() {
        try {
            const parsed = JSON.parse(localStorage.getItem(IMAGE_STORAGE_KEY) || '[]');
            return Array.isArray(parsed) ? parsed : [];
        } catch (error) {
            return [];
        }
    }

    function saveImages(images) {
        localStorage.setItem(IMAGE_STORAGE_KEY, JSON.stringify(images || []));
    }

    function fileToDataUrl(file) {
        return new Promise(function (resolve, reject) {
            if (!file) {
                resolve('');
                return;
            }
            const reader = new FileReader();
            reader.onload = function () { resolve(reader.result); };
            reader.onerror = function () { reject(new Error('Image read failed')); };
            reader.readAsDataURL(file);
        });
    }

    function resetForm() {
        imageForm.reset();
        uploadedImageData = '';
        imagePreview.src = '/images/5.jpg';
        imageMsg.textContent = 'All fields are required.';
        imageMsg.className = 'text-sm font-bold text-adminMuted';
    }

    function render() {
        const images = loadImages();
        const categorySet = new Set(images.map(function (item) { return item.category; }).filter(Boolean));

        document.getElementById('img-total').textContent = images.length;
        document.getElementById('img-categories').textContent = categorySet.size;
        document.getElementById('img-latest').textContent = images.length ? formatDate(images[0].createdAt) : '-';

        if (!images.length) {
            imageGrid.innerHTML = '<article class="rounded-xl border border-adminBorder bg-white p-6 text-center sm:col-span-2 xl:col-span-3">' +
                '<p class="font-bold text-lg">No images added yet.</p>' +
                '<p class="text-sm text-adminMuted mt-1">Upload your first gallery image above.</p>' +
            '</article>';
            return;
        }

        imageGrid.innerHTML = images.map(function (item) {
            return '<article class="rounded-xl border border-adminBorder bg-white overflow-hidden">' +
                '<img src="' + escapeHtml(item.image || '/images/5.jpg') + '" alt="' + escapeHtml(item.title) + '" class="w-full h-40 object-cover" onerror="this.src=\'../images/5.jpg\'">' +
                '<div class="p-4">' +
                    '<div class="flex items-center justify-between gap-2">' +
                        '<h4 class="font-extrabold">' + escapeHtml(item.title) + '</h4>' +
                        '<span class="pill bg-slate-100 text-slate-700 border border-adminBorder">' + escapeHtml(item.category) + '</span>' +
                    '</div>' +
                    '<div class="mt-3 flex items-center justify-between">' +
                        '<span class="text-xs text-adminMuted">Added: ' + escapeHtml(formatDate(item.createdAt)) + '</span>' +
                        '<button class="delete-image px-3 py-1 rounded-lg text-xs font-bold bg-red-100 text-red-700" data-id="' + escapeHtml(item.id) + '">' +
                            '<i class="fas fa-trash mr-1"></i>Delete' +
                        '</button>' +
                    '</div>' +
                '</div>' +
            '</article>';
        }).join('');
    }

    imageFileInput.addEventListener('change', async function (event) {
        const file = event.target.files[0];
        try {
            uploadedImageData = await fileToDataUrl(file);
            imagePreview.src = uploadedImageData || '/images/5.jpg';
        } catch (error) {
            uploadedImageData = '';
            imagePreview.src = '/images/5.jpg';
            imageMsg.textContent = 'Image upload failed. Try another file.';
            imageMsg.className = 'text-sm font-bold text-red-700';
        }
    });

    imageForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const title = document.getElementById('image-title').value.trim();
        const category = document.getElementById('image-category').value.trim();

        if (!title || !category || !uploadedImageData) {
            imageMsg.textContent = 'Please fill all fields and upload image.';
            imageMsg.className = 'text-sm font-bold text-red-700';
            return;
        }

        const images = loadImages();
        images.unshift({
            id: Date.now().toString(),
            title: title,
            category: category,
            image: uploadedImageData,
            createdAt: new Date().toISOString()
        });
        saveImages(images);

        resetForm();
        imageMsg.textContent = 'Image added successfully.';
        imageMsg.className = 'text-sm font-bold text-adminGreen';
        render();
    });

    imageGrid.addEventListener('click', function (event) {
        const deleteBtn = event.target.closest('.delete-image');
        if (!deleteBtn) return;

        const id = deleteBtn.dataset.id;
        const nextImages = loadImages().filter(function (item) {
            return String(item.id) !== String(id);
        });
        saveImages(nextImages);

        imageMsg.textContent = 'Image removed.';
        imageMsg.className = 'text-sm font-bold text-amber-700';
        render();
    });

    resetForm();
    render();
</script>
</body>
</html>






